/*
	jquery.scrollex.js v0.2.1 | (c) 2014 @ajlkn | Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
*/

(function($) {

	$.fn._scrollex = function(options) {

		var	opts = $.extend({
				mode: 'vertical',
				top: 0,
				bottom: 0
			}, options),
			$this = $(this),
			$window = $(window),
			$document = $(document),
			viewport = null,
			entered = false,
			state = null;

		// Modes
			var modes = {

				compute: function() {

					// Offset
						var offset = $this.offset();

					// If viewport is null, calculate it.
						if (!viewport)
							viewport = {
								top: $window.scrollTop(),
								bottom: $window.scrollTop() + $window.height()
							};

					// Return state
						if (opts.mode == 'vertical')
							return {
								top: offset.top,
								bottom: offset.top + $this.height(),
								flag: false
							};

				},

				test: function() {

					var state = modes.compute(),
						scroll = $window.scrollTop(),
						top, bottom;

					if (!state)
						return false;

					top = scroll + opts.top;
					bottom = scroll + $window.height() + opts.bottom;

					if (top <= state.bottom && bottom >= state.top) {

						if (!entered) {

							$this.trigger('enter');
							entered = true;

						}

						state.flag = true;

					}
					else {

						if (entered) {

							$this.trigger('leave');
							entered = false;

						}

					}

					return state;

				}

			};

		// Monitor
			var monitor = function() {

				modes.test();
				viewport = null;

			};

		// Events
			$window.on('scroll.scrollex', monitor);
			$window.on('resize.scrollex', monitor);

		// Init
			modes.test();

		return $this;

	};

	$.fn.scrollex = function(options) {

		if (this.length == 0)
			return $this;

		if (this.length == 1) {

			new $.fn._scrollex.apply(this, arguments);
			return this;

		}

		return this.each(function() {
			$(this)._scrollex(options);
		});

	};

})(jQuery);

